-- FUNCTION: public.jjla_getproductssellerremaining(integer, integer)

-- DROP FUNCTION IF EXISTS public.jjla_getproductssellerremaining(integer, integer);

CREATE OR REPLACE FUNCTION public.jjla_getproductssellerremaining(
	p_idseller integer,
	p_category integer)
    RETURNS SETOF products 
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE PARALLEL UNSAFE
    ROWS 1000

AS $BODY$
DECLARE
    my_product products;
BEGIN
    FOR my_product IN
        SELECT products.*
        FROM products
        LEFT JOIN seller_products
        ON products.product_id = seller_products.product_id 
           AND seller_products.seller_id = p_idseller
        WHERE seller_products.product_id IS NULL 
          AND products.category_id = p_category
    LOOP
        RETURN NEXT my_product;
    END LOOP;
    RETURN;
END;
$BODY$;

ALTER FUNCTION public.jjla_getproductssellerremaining(integer, integer)
    OWNER TO postgres;
